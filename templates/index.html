<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CONSULTA CIUDADANA</title>
    <style>
        body, html { margin:0; padding:0; width:100%; height:100%; font-family: Arial, sans-serif; background:#fff; overflow:hidden; }
        #sello { position:fixed; top:0; left:0; width:100%; height:100%; background:#fff; display:none; flex-direction:column; align-items:center; justify-content:center; z-index:9999; text-align:center; }
        #splash { position:fixed; top:0; left:0; width:100%; height:100%; background:#fff; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:8888; }
        #main { display:none; flex-direction:column; align-items:center; justify-content:center; height:100vh; text-align:center; }
        .bar-bg { width:200px; height:10px; background:#eee; border-radius:10px; margin:20px; }
        .bar-fill { width:0%; height:100%; background:#000; transition: width 0.1s; }
        .btn { display:inline-block; margin:10px; padding:20px; border:1px solid #eee; border-radius:20px; text-decoration:none; color:#000; font-weight:bold; width:200px; }
        .btn img { width:80px; display:block; margin:0 auto 10px; }
        .msg { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); display:flex; align-items:center; justify-content:center; z-index:10000; }
    </style>
</head>
<body>

    <div id="sello">
        <h1 style="color:red; font-size:4rem;">⚠️</h1>
        <h2>ACCESO LIMITADO</h2>
        <p>Dispositivo ya registrado.</p>
    </div>

    <div id="splash">
        <div style="display:flex; gap:10px;">
            <img src="/static/accion2.png" width="80" onerror="this.style.display='none'">
            <img src="/static/accion.png" width="80" onerror="this.style.display='none'">
        </div>
        <div class="bar-bg"><div class="bar-fill" id="fill"></div></div>
        <h3 id="load">0%</h3>
    </div>

    <div id="main">
        <h1>CONSULTA CIUDADANA</h1>
        <div style="display:flex; flex-wrap:wrap; justify-content:center;">
            <a href="/votar/ORURO" class="btn"><img src="/static/oruro.png" onerror="this.src='https://via.placeholder.com/80?text=ORURO'">VOTAR ORURO</a>
            <a href="/votar/LA PAZ" class="btn"><img src="/static/lapaz.png" onerror="this.src='https://via.placeholder.com/80?text=LA+PAZ'">VOTAR LA PAZ</a>
        </div>
        <a href="/reporte" style="margin-top:20px; display:block; font-weight:bold; color:blue;">VER RESULTADOS</a>
    </div>

    {% if msg_type != '' %}
    <div class="msg">
        <div style="background:#fff; padding:40px; border:2px solid #eee; border-radius:30px; text-align:center;">
            <h2 style="color:{{ 'blue' if msg_type == 'success' else 'red' }};">{{ 'EXITO' if msg_type == 'success' else 'ERROR' }}</h2>
            <h1 style="font-size:3rem;">{{ ci }}</h1>
            <a href="/" onclick="saveVote('{{ msg_type }}')" style="background:#000; color:#fff; padding:15px 30px; text-decoration:none; border-radius:10px; display:inline-block; margin-top:20px;">CONTINUAR</a>
        </div>
    </div>
    {% endif %}

    <script>
        function saveVote(t) { if(t === 'success') localStorage.setItem('voted_2026', '1'); }

        window.onload = () => {
            if ("{{ reset }}" === "true") { localStorage.removeItem('voted_2026'); window.location.href="/"; return; }

            if (localStorage.getItem('voted_2026') === '1' && "{{ msg_type }}" === "") {
                document.getElementById('splash').style.display = 'none';
                document.getElementById('sello').style.display = 'flex';
                return;
            }

            let p = 0;
            let itv = setInterval(() => {
                p += 10;
                document.getElementById('fill').style.width = p + '%';
                document.getElementById('load').innerText = p + '%';
                if(p >= 100) {
                    clearInterval(itv);
                    document.getElementById('splash').style.display = 'none';
                    document.getElementById('main').style.display = 'flex';
                    document.body.style.overflow = 'auto';
                }
            }, 100);
        };
    </script>
</body>
</html>
